<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Sensei pro ČZU</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #334155; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        .blue-background-class { background-color: #dbeafe !important; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #e2e8f0; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 8px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        .view-transition { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .modal-transition { animation: fadeInScale 0.3s ease-out; }
        @keyframes fadeInScale { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1.0); } }
        .spinner { border: 3px solid rgba(255,255,255,0.3); width: 20px; height: 20px; border-radius: 50%; border-left-color: #fff; animation: spin 1s ease infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .pulse-loader { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        .typing-indicator span { height: 8px; width: 8px; float: left; margin: 0 1px; background-color: #94a3b8; display: block; border-radius: 50%; opacity: 0.4; animation: bob 1s infinite; }
        .typing-indicator span:nth-of-type(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-of-type(3) { animation-delay: 0.4s; }
        @keyframes bob { 50% { transform: translateY(-3px); } }
        .ai-glow { animation: ai-glow 2.5s ease-in-out infinite; }
        @keyframes ai-glow {
            0%, 100% { box-shadow: 0 0 5px #fde68a, 0 0 10px #fde68a; }
            50% { box-shadow: 0 0 20px #facc15, 0 0 30px #facc15; }
        }
        .lesson-bubble { position: relative; cursor: grab; transition: all 0.2s ease; }
        .lesson-bubble:active { cursor: grabbing; transform: scale(1.05); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .dragging { opacity: 0.5; transform: scale(1.05); border: 2px dashed #166534; }
        .drag-over { background-color: #dcfce7; border-color: #22c55e; border-style: dashed; }
        .upload-zone { border: 2px dashed #d1d5db; transition: all 0.2s ease; }
        .upload-zone.drag-over-file { border-color: #22c55e; background-color: #f0fdf4; transform: scale(1.02); }
        .phone-mockup { width: 340px; height: 680px; border: 14px solid #1f2937; border-radius: 40px; background-color: #f3f4f6; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.35); position: relative; }
        .phone-mockup::before { content: ''; position: absolute; top: 0px; left: 50%; transform: translateX(-50%); width: 160px; height: 24px; background: #1f2937; border-radius: 0 0 12px 12px; }
        .phone-screen { width: 100%; height: 100%; border-radius: 26px; background-image: url('https://i.pinimg.com/736x/8c/98/99/8c98994518b575bfd8c949e91d20548b.jpg'); background-size: cover; display: flex; flex-direction: column; overflow: hidden; }
        .phone-header { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); color: #1f2937; padding: 16px; border-bottom: 1px solid #e5e7eb; }
        .chat-area { flex-grow: 1; padding: 12px; overflow-y: auto; display: flex; flex-direction: column; gap: 0.75rem;}
        .chat-bubble { padding: 0.6rem 1rem; border-radius: 1.1rem; max-width: 85%; line-height: 1.4; animation: popIn 0.3s ease-out; }
        @keyframes popIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1.0); } }
        .chat-bubble-user { background-color: #166534; color: white; align-self: flex-end; border-bottom-right-radius: 0.3rem; }
        .chat-bubble-bot { background-color: #fff; color: #334155; align-self: flex-start; border-bottom-left-radius: 0.3rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        #ai-assistant-btn {
            position: fixed; bottom: 2rem; right: 2rem;
            width: 64px; height: 64px;
            background: #166534;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: white; box-shadow: 0 10px 20px rgba(22, 101, 52, 0.3);
            cursor: pointer; transition: all 0.3s ease; z-index: 100;
        }
        #ai-assistant-btn:hover { transform: scale(1.1); box-shadow: 0 15px 25px rgba(22, 101, 52, 0.4); }
        .chart-bar { transition: height 0.5s ease-out; }
    </style>
</head>
<body class="antialiased">
    <div id="app-container" class="h-screen w-screen"></div>
    <div id="ai-assistant-btn" title="AI Asistent">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 8V4H8"/><rect x="4" y="12" width="8" height="8" rx="2"/><path d="M8 12v-2a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2v-2"/><path d="M16 12h4a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2z"/></svg>
    </div>
    <template id="login-template">
        <div class="w-full h-full flex items-center justify-center bg-slate-100 p-4">
            <div class="w-full max-w-md p-8 lg:p-10 space-y-6 bg-white rounded-2xl shadow-xl text-center view-transition">
                <div class="inline-block p-4 bg-green-100 rounded-full"><span class="text-4xl font-black text-green-800">ČZU</span></div>
                <h1 class="text-3xl font-extrabold text-slate-800">Vítejte v AI Sensei</h1>
                <p class="text-slate-500">Vstupte do moderní vzdělávací platformy přizpůsobené pro Českou zemědělskou univerzitu v Praze.</p>
                <div class="space-y-4 pt-4">
                    <button id="login-professor" class="w-full flex items-center justify-center py-3 px-4 rounded-xl shadow-sm text-lg font-semibold text-white bg-green-700 hover:bg-green-800 transition-all duration-300 transform hover:scale-105">Vstoupit jako Profesor</button>
                    <div class="border-t border-slate-200 pt-4 mt-4">
                        <!-- Login Form -->
                        <div id="login-form" class="space-y-3">
                            <input type="email" id="login-email" placeholder="Zadejte váš email" class="w-full px-4 py-3 border border-slate-300 rounded-lg text-slate-700 focus:ring-green-500 focus:border-green-500" required>
                            <input type="password" id="login-password" placeholder="Zadejte vaše heslo" class="w-full px-4 py-3 border border-slate-300 rounded-lg text-slate-700 focus:ring-green-500 focus:border-green-500" required>
                            <button id="login-btn" class="w-full flex items-center justify-center py-3 px-4 rounded-xl shadow-sm text-lg font-semibold text-white bg-blue-600 hover:bg-blue-700 transition-all duration-300 transform hover:scale-105">Přihlásit</button>
                            <a id="show-register-form" href="#" class="block text-center mt-4 text-sm text-slate-600 hover:underline">Nemáte účet? Zaregistrujte se</a>
                        </div>
                        <!-- Registration Form -->
                        <div id="register-form" class="hidden space-y-3">
                            <input type="email" id="register-email" placeholder="Zadejte váš email" class="w-full px-4 py-3 border border-slate-300 rounded-lg text-slate-700 focus:ring-green-500 focus:border-green-500" required>
                            <input type="password" id="register-password" placeholder="Zadejte nové heslo" class="w-full px-4 py-3 border border-slate-300 rounded-lg text-slate-700 focus:ring-green-500 focus:border-green-500" required>
                            <button id="register-btn" class="w-full flex items-center justify-center py-3 px-4 rounded-xl shadow-sm text-lg font-semibold text-white bg-green-700 hover:bg-green-800 transition-all duration-300 transform hover:scale-105">Zaregistrovat</button>
                            <a id="show-login-form" href="#" class="block text-center mt-4 text-sm text-slate-600 hover:underline">Máte již účet? Přihlaste se</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Student Detail View (moved here to be a top-level element) -->
    <div id="student-detail-view" class="hidden p-8 bg-slate-100 flex-grow">
        <!-- Content will be rendered here by main.js -->
    </div>

    <!-- Student Lesson View -->
<div id="student-lesson-view" class="hidden h-screen w-screen bg-slate-50 flex flex-col font-sans">
    <!-- Header -->
    <header class="bg-white shadow-sm p-4 flex items-center justify-between z-20 flex-shrink-0 border-b border-slate-200">
        <button id="back-to-student-dashboard-btn" class="flex items-center gap-2 text-slate-600 hover:text-green-700 transition-colors font-medium rounded-lg px-3 py-2 -ml-3 hover:bg-green-50">
            <i class="fas fa-arrow-left"></i>
            <span>Zpět na přehled</span>
        </button>
        <div class="flex flex-col items-center">
            <h1 id="student-lesson-title" class="text-xl font-bold text-slate-800">Načítání názvu lekce...</h1>
            <div class="w-72 bg-slate-200 rounded-full h-2.5 mt-2 shadow-inner">
                <div id="lesson-progress-bar" class="bg-green-600 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
        </div>
        <div class="w-48"></div> <!-- Spacer to balance the header -->
    </header>

    <!-- Main container -->
    <div class="flex-grow flex overflow-hidden">
        <!-- Tab Navigation -->
        <nav class="w-64 bg-white border-r border-slate-200 p-4 flex flex-col justify-between">
            <div class="space-y-2">
                <h2 class="px-3 text-sm font-semibold text-slate-500 uppercase tracking-wider">Obsah lekce</h2>
                <button data-tab="text" class="student-lesson-tab-btn w-full flex items-center gap-3 px-3 py-2.5 text-left text-base font-medium rounded-lg bg-green-100 text-green-800">
                    <i class="fa-solid fa-book-open w-5 text-center"></i>
                    <span>Textová část</span>
                </button>
                <button data-tab="video" class="student-lesson-tab-btn w-full flex items-center gap-3 px-3 py-2.5 text-left text-base font-medium rounded-lg text-slate-600 hover:bg-slate-100">
                    <i class="fa-solid fa-video w-5 text-center"></i>
                    <span>Video</span>
                </button>
                <button data-tab="extra" class="student-lesson-tab-btn w-full flex items-center gap-3 px-3 py-2.5 text-left text-base font-medium rounded-lg text-slate-600 hover:bg-slate-100">
                    <i class="fa-solid fa-graduation-cap w-5 text-center"></i>
                    <span>Učení na doma</span>
                </button>
                <hr class="my-4 border-slate-200">
                <h2 class="px-3 text-sm font-semibold text-slate-500 uppercase tracking-wider">Interaktivní část</h2>
                <button data-tab="takeaways" class="student-lesson-tab-btn w-full flex items-center gap-3 px-3 py-2.5 text-left text-base font-medium rounded-lg text-slate-600 hover:bg-slate-100">
                    <i class="fa-solid fa-lightbulb w-5 text-center"></i>
                    <span>Klíčové body</span>
                </button>
                <button data-tab="assistant" class="student-lesson-tab-btn w-full flex items-center gap-3 px-3 py-2.5 text-left text-base font-medium rounded-lg text-slate-600 hover:bg-slate-100">
                    <i class="fa-solid fa-robot w-5 text-center"></i>
                    <span>AI Asistent</span>
                </button>
                 <button data-tab="professor-chat" class="student-lesson-tab-btn w-full flex items-center gap-3 px-3 py-2.5 text-left text-base font-medium rounded-lg text-slate-600 hover:bg-slate-100">
                    <i class="fa-solid fa-mobile-screen-button w-5 text-center"></i>
                    <span>Chat s profesorem</span>
                </button>
            </div>
            <div class="p-2 bg-slate-100 rounded-lg">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-blue-200 text-blue-800 flex items-center justify-center font-bold" id="student-avatar"></div>
                    <div>
                        <p class="font-semibold text-slate-800 text-sm" id="student-email-display">student@email.com</p>
                        <p class="text-xs text-slate-500">Student</p>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Tab Content Area -->
        <main class="flex-grow overflow-y-auto p-8 bg-slate-50">
            <div id="student-lesson-content-container">
                <!-- Text Tab -->
                <div id="tab-text" class="student-lesson-tab-pane">
                    <div id="lesson-text-content" class="prose prose-lg max-w-none text-slate-700 leading-relaxed bg-white p-8 rounded-lg shadow-md"></div>
                </div>
                <!-- Video Tab -->
                <div id="tab-video" class="student-lesson-tab-pane hidden">
                    <div id="lesson-video-content" class="bg-black aspect-video rounded-xl overflow-hidden shadow-2xl flex items-center justify-center max-w-4xl mx-auto">
                        <p class="text-white">Sem přijde video</p>
                    </div>
                </div>
                <!-- Extra Materials Tab -->
                <div id="tab-extra" class="student-lesson-tab-pane hidden">
                     <div id="lesson-extra-content" class="space-y-6 bg-white p-8 rounded-lg shadow-md"></div>
                </div>
                <!-- Key Takeaways Tab -->
                <div id="tab-takeaways" class="student-lesson-tab-pane hidden">
                    <div class="text-center max-w-2xl mx-auto">
                        <i class="fas fa-lightbulb text-yellow-400 text-5xl"></i>
                        <h2 class="text-3xl font-bold text-slate-800 mt-4">Klíčové body lekce</h2>
                        <p class="text-slate-500 mt-2 mb-6">Nechte si od AI vygenerovat 3 nejdůležitější body z textu lekce.</p>
                        <button id="generate-takeaways-btn" class="bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 transition-all transform hover:scale-105 shadow-lg">
                            <i class="fas fa-wand-magic-sparkles mr-2"></i>
                            Vygenerovat shrnutí
                        </button>
                        <div id="takeaways-result" class="mt-8 text-left prose max-w-none"></div>
                    </div>
                </div>
                <!-- AI Assistant Tab -->
                <div id="tab-assistant" class="student-lesson-tab-pane hidden">
                    <div class="max-w-3xl mx-auto bg-white p-6 rounded-2xl shadow-lg h-[70vh] flex flex-col">
                        <div class="flex items-center gap-4 border-b border-slate-200 pb-4">
                            <div class="w-12 h-12 bg-green-100 text-green-700 rounded-full flex items-center justify-center text-2xl"><i class="fa-solid fa-robot"></i></div>
                            <div>
                                <h2 class="text-xl font-bold text-slate-800">AI Asistent</h2>
                                <p class="text-sm text-slate-500">Zeptejte se na cokoliv ohledně obsahu této lekce.</p>
                            </div>
                        </div>
                        <div id="ai-assistant-chat-history" class="flex-grow overflow-y-auto p-4 my-4 space-y-4">
                            <!-- Chat messages will be appended here -->
                             <div class="flex gap-3 items-start">
                                <div class="w-8 h-8 bg-green-100 text-green-700 rounded-full flex items-center justify-center flex-shrink-0"><i class="fa-solid fa-robot"></i></div>
                                <div class="bg-slate-100 p-3 rounded-lg rounded-tl-none">
                                    <p class="text-slate-700">Ahoj! Na co se chcete zeptat k této lekci?</p>
                                </div>
                            </div>
                        </div>
                        <div class="border-t border-slate-200 pt-4">
                            <div class="relative">
                                <textarea id="ai-assistant-input" placeholder="Vaše otázka..." class="w-full border-slate-300 rounded-lg p-3 pr-24 text-slate-800 focus:ring-2 focus:ring-green-500 focus:border-green-500 resize-none" rows="2"></textarea>
                                <button id="ai-assistant-send-btn" class="absolute right-3 top-1/2 -translate-y-1/2 bg-green-600 text-white rounded-lg px-5 py-2 font-semibold hover:bg-green-700 transition-all">
                                    Odeslat
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Professor Chat Tab -->
                <div id="tab-professor-chat" class="student-lesson-tab-pane hidden">
                     <div class="flex items-center justify-center p-4">
                        <div class="phone-mockup">
                            <div class="phone-screen">
                                <div class="phone-header">
                                    <h3 class="font-bold text-center">Profesor Chat</h3>
                                </div>
                                <div id="chat-history-area" class="chat-area">
                                    <div class="chat-bubble chat-bubble-bot">Ahoj! Jsem tu, abych ti pomohl. Na co se chceš zeptat?</div>
                                </div>
                                <div class="p-3 border-t border-gray-200 bg-white flex items-center space-x-2">
                                    <input id="student-chat-input" type="text" placeholder="Napište zprávu..." class="w-full border-gray-300 rounded-full py-2 px-4 text-sm text-slate-800 focus:ring-green-500 focus:border-green-500">
                                    <button id="student-send-message-btn" class="bg-green-600 text-white rounded-full p-2 flex-shrink-0 hover:bg-green-700">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

    <template id="main-app-template">
        <div class="h-screen w-screen flex bg-white shadow-lg overflow-hidden">
            <nav class="w-20 bg-green-800 p-3 flex flex-col items-center justify-between flex-shrink-0">
                <div>
                    <a href="#" class="w-12 h-12 rounded-full flex items-center justify-center mb-8 bg-white text-green-800" title="AI Sensei pro ČZU"><span class="text-xl font-black">ČZU</span></a>
                    <ul id="main-nav" class="flex flex-col space-y-2"></ul>
                </div>
                <button id="logout-btn" class="nav-item p-3 rounded-lg flex items-center justify-center text-green-200 hover:bg-green-700 hover:text-white transition-colors" title="Odhlásit">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                </button>
            </nav>
            <div id="role-content-wrapper" class="flex-grow flex"></div>
            <div id="telegram-interaction-view" class="hidden p-8">
                <h2 class="text-2xl font-bold text-white mb-6">Komunikace se studenty</h2>
                <div id="student-telegram-list" class="space-y-4">
                </div>
            </div>
            <div id="student-analysis-view" class="hidden p-8 bg-slate-100 flex-grow">
                <h2 class="text-3xl font-extrabold text-slate-800 mb-6">Analýza studentů</h2>
                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <div id="analysis-student-list" class="space-y-4">
                        <!-- Student list will be rendered here -->
                    </div>
                </div>
            </div>
        </div>
    </template>
    <div id="modal-container"></div>

    <div id="media-library-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-20 mx-auto p-5 border w-1/2 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Knihovna médií</h3>
                <div class="mt-2 px-7 py-3">
                    <p class="text-sm text-gray-500">Zde můžete nahrát obecné soubory pro celý kurz.</p>
                    <div id="course-media-upload-area" class="mt-4 border-2 border-dashed border-gray-300 rounded-lg p-10 text-center cursor-pointer hover:bg-gray-50">
                        <p>Přetáhněte soubory sem nebo klikněte pro výběr</p>
                        <input type="file" id="course-media-file-input" class="hidden" multiple>
                    </div>
                    <ul id="course-media-list" class="mt-4 text-left">
                    </ul>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="close-media-library-btn" class="px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300">
                        Zavřít
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- The main application script will now handle all logic -->
    <script type="module" src="/js/main.js"></script>
</body>
</html>