rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    function isProfessor() {
      return get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'professor';
    }

    match /{allPaths=**} {
        // Povolí zápis každému prihlásenému používateľovi (môžeme to neskôr sprísniť, ak bude treba)
        allow write: if request.auth != null;

        // Povolí čítanie, ak je používateľ vlastníkom súboru (podľa ownerId v metadátach),
        // alebo ak je profesorom.
        allow read: if request.auth.uid == resource.metadata.ownerId || isProfessor() || request.auth.token.email == 'profesor@profesor.cz';
    }
  }
}
