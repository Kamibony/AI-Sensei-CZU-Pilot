rules_version = '2';
service firebase.storage {
match /b/{bucket}/o {

function isProfessor() {
return request.auth != null && request.auth.token.role == 'professor';
}

match /public-assets/{allPaths=**} {
allow read;
}

match /courses/{courseId}/media/{fileId} {

// ČÍTAŤ (read) môže vlastník (overujeme metadáta, ktoré nastavila funkcia 'finalizeUpload')
allow read: if (isProfessor() && request.auth.uid == resource.metadata.ownerId)
|| request.auth.token.email == 'profesor@profesor.cz';

// VYTVORIŤ (create) nemôže NIKTO priamo.
// Nahrávanie prebieha výlučne cez časovo obmedzené Signed URLs.
allow create: if false;

// MAZAŤ (delete) môže vlastník
allow delete: if (isProfessor() && request.auth.uid == resource.metadata.ownerId)
|| request.auth.token.email == 'profesor@profesor.cz';
}

// Záložné pravidlo: Všetko ostatné je prísne zakázané.
match /{allPaths=**} {
allow read, write: if false;
}
}
}
